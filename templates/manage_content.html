{% extends "base.html" %}

{% block title %}Manage Content | WUSL Hackerspace{% endblock %}

{% block content %}
<section class="content-section" style="max-width: 1000px; margin: 0 auto;">
    <div class="auth-card" style="text-align: left;">
        <h2><i class="fa-solid fa-folder-open"></i> Content Management</h2>
        <p>Manage your projects and news articles. Control visibility and keep your content updated.</p>

        {% with messages = get_flashed_messages() %}
          {% if messages %}
            <div class="flash-messages">
              {% for message in messages %}
                <p class="flash">{{ message }}</p>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <div class="management-controls" style="margin-top: 2rem; display: flex; gap: 1rem;">
            <a href="{{ url_for('create_article') }}" class="add-block-btn" style="flex: none; padding: 0.5rem 1rem;">
                <i class="fa-solid fa-plus"></i> New Content
            </a>
        </div>

        <div class="tabs" style="margin-top: 2rem; border-bottom: 2px solid var(--gray-mid); display: flex; gap: 2rem;">
            <button class="tab-btn active" onclick="showTab('news-tab', this)">News Articles</button>
            <button class="tab-btn" onclick="showTab('projects-tab', this)">Featured Projects</button>
        </div>

        <div class="tab-content" id="news-tab">
            <table class="user-management-table" style="margin-top: 1rem;">
                <thead>
                    <tr>
                        <th>Article</th>
                        <th>Created</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for article in articles %}
                    <tr>
                        <td><strong>{{ article.title }}</strong></td>
                        <td>{{ article.created_at.strftime('%Y-%m-%d') }}</td>
                        <td>
                            <span class="status-badge {% if article.is_private %}private{% else %}public{% endif %}">
                                <i class="fa-solid {% if article.is_private %}fa-lock{% else %}fa-globe{% endif %}"></i>
                                {{ 'Private' if article.is_private else 'Public' }}
                            </span>
                        </td>
                        <td>
                            <div style="display: flex; gap: 0.5rem;">
                                <a href="{{ url_for('edit_content', type='news', id=article.id) }}" class="action-btn" title="Edit">
                                    <i class="fa-solid fa-pen"></i>
                                </a>
                                <a href="{{ url_for('toggle_visibility', type='news', id=article.id) }}" class="action-btn" title="Toggle Visibility">
                                    <i class="fa-solid fa-eye-slash"></i>
                                </a>
                                <a href="{{ url_for('delete_content', type='news', id=article.id) }}" class="action-btn delete" onclick="return confirm('Are you sure you want to delete this article?')" title="Delete">
                                    <i class="fa-solid fa-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="4" style="text-align: center; padding: 3rem; color: var(--text-muted);">No news articles found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="tab-content" id="projects-tab" style="display: none;">
            <table class="user-management-table" style="margin-top: 1rem;">
                <thead>
                    <tr>
                        <th>Project</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for project in projects %}
                    <tr>
                        <td><strong>{{ project.title }}</strong></td>
                        <td>
                            <span class="status-badge {% if project.is_private %}private{% else %}public{% endif %}">
                                <i class="fa-solid {% if project.is_private %}fa-lock{% else %}fa-globe{% endif %}"></i>
                                {{ 'Private' if project.is_private else 'Public' }}
                            </span>
                        </td>
                        <td>
                            <div style="display: flex; gap: 0.5rem;">
                                <a href="{{ url_for('edit_content', type='project', id=project.id) }}" class="action-btn" title="Edit">
                                    <i class="fa-solid fa-pen"></i>
                                </a>
                                <a href="{{ url_for('toggle_visibility', type='project', id=project.id) }}" class="action-btn" title="Toggle Visibility">
                                    <i class="fa-solid fa-eye-slash"></i>
                                </a>
                                <a href="{{ url_for('delete_content', type='project', id=project.id) }}" class="action-btn delete" onclick="return confirm('Are you sure you want to delete this project?')" title="Delete">
                                    <i class="fa-solid fa-trash"></i>
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="3" style="text-align: center; padding: 3rem; color: var(--text-muted);">No projects found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</section>

<style>
.tab-btn {
    background: none;
    border: none;
    padding: 0.8rem 0;
    font-weight: 700;
    color: var(--text-muted);
    cursor: pointer;
    border-bottom: 3px solid transparent;
    transition: all 0.3s;
}

.tab-btn.active {
    color: var(--mauve);
    border-bottom-color: var(--mauve);
}

.status-badge {
    font-size: 0.75rem;
    font-weight: 700;
    padding: 0.3rem 0.6rem;
    border-radius: 20px;
    display: flex;
    align-items: center;
    gap: 0.4rem;
    width: fit-content;
}

.status-badge.public {
    background: #e8f5e9;
    color: #2e7d32;
}

.status-badge.private {
    background: #fff3e0;
    color: #ef6c00;
}

.action-btn {
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 6px;
    background: var(--gray-light);
    color: var(--dark-brown);
    text-decoration: none;
    transition: all 0.2s;
}

.action-btn:hover {
    background: var(--tan);
    color: white;
}

.action-btn.delete:hover {
    background: #e74c3c;
    color: white;
}
</style>

<script>
function showTab(tabId, btn) {
    document.querySelectorAll('.tab-content').forEach(t => t.style.display = 'none');
    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
    
    document.getElementById(tabId).style.display = 'block';
    btn.classList.add('active');
}
</script>
{% endblock %}
